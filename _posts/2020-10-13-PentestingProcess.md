---
layout: post
title: 渗透流程
date: 2020-10-21
tags: 渗透笔记
---

这篇主要是帮自己梳理渗透流程，日常处于找不到突破点的状态，所以主要偏向记录信息收集这一块，找不到突破点就返回来继续收集信息。

下面步骤对应的工具可以在[这里](https://rooaw.github.io/2020/10/penetration-collection/)查看更多。

1. 假设拿到关键字，先搜索关键字，看能不能有官网，没有就各种 Google hacking

1. 有了官网可以搜[子域名](https://github.com/shmilylty/OneForAll)，查[备案信息](http://www.beian.miit.gov.cn/)，找同 ip 网站和旁站，fofa，shodan 可以根据图标来搜索资产

1. 找真实 ip：
	* 用[国外多地访问](https://asm.ca.com/en/ping.php)
	* [绕过cdn](https://github.com/Tai7sy/fuckcdn)

1. wappalyzer 插件获取一些信息；看是否是 cms：[CMSScan](https://github.com/ajinabraham/CMSScan)

1. 扫描走一波：
	* 端口扫描（nmap）
	* 漏扫(awvs、appscan、xray、Nikto)
	* 目录扫描(wfuzz，御剑、dirbuster)
	* 看是否有明显漏洞和敏感目录以及端口连接和爆破，后台目录比如 admin，除了加在 url 后尝试，也可以加在域名上

1. 扫的时候一边浏览网站看是否有突破点：
	* 注入
		可以多想想是否可以注入其他的东西，比如只测试了 SQL 注入，但也许其实可以 命令注入；在乌云看到一个例子，根据 link 参数跳转，如果是我可能只试一下能不能跳到百度就完事了，但是这个漏洞测试的是跳转本地：http://127.0.0.1:8080 ， 而且将 ip 地址转换为 10 进制：http://2130706433:8080
	* 上传、逻辑、弱口令、后台等；
	* 查看源码、图片地址，[抓取js文件中的url?](https://github.com/Threezh1/JSFinder)
	* 记得注册不要用自己的手机邮箱
	* xss:
		* [xss绕过](https://www.freebuf.com/articles/web/195507.html)
		* [xss绕过](https://wooyun.js.org/drops/Bypass%20xss%E8%BF%87%E6%BB%A4%E7%9A%84%E6%B5%8B%E8%AF%95%E6%96%B9%E6%B3%95.html)
	* csrf:
		* [绕过](https://medium.com/swlh/bypassing-csrf-protection-c9b217175ee)[中文版](https://xz.aliyun.com/t/6176)


1. 有 waf 扫描会困难一点，具体的碰到了再说

1. 然后根据目标的架构：语言、服务器等，不同类型不同版本都有漏洞，包括常用端口的利用，前端用的框架也可以搜一下是否存在漏洞



**常见漏洞：**

1. windows系统漏洞：
	* http.sys
		`curl -v IP -H "Host:irrelevant" -H "Range: bytes=0-18446744073709551615"`
	* 3389端口

1. java(.action、.do)漏洞：
	* s2

1. 端口漏洞：
	* 21、22 爆破
	* 445 ms17-010
	* 3389 爆破、cve-2019-0708



**日常经验：**

* 今天拿的一份含义账号密码的 json 数据，随手翻看到的密码都是1，我就下意识认为这里的账号密码都是1，然后老大让我多翻翻，emm...竟然有诈！还有一小部分不是1的。一定要带着求真的眼光看数据。

* 还是上面那份数据，别人找到那个网站许多要登陆的系统，然后用这些账号密码登进去了，并且提到用户名都是五位数字可以爆破。然后我去找，找到的后台都不能用那些账号登陆...然后平时爆破密码多，爆破用户名这点一下子也转不过弯来想到，虽然不一定有对应的密码，但是思路真的不要僵。

* 扫出来一个 xss，在 chrome 和 firefox 都没复现，只有在 ie 上才弹出了。

